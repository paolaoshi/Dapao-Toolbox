# 图片排列节点 - 无边框模式功能说明

## 新增功能

为 `image_layout_node.py` 添加了两种新的批次图片缩放模式：

### 1. 无边框裁剪模式
- **功能**：自动统计所有批次图片，找出最大宽度和最大高度，以此作为统一尺寸
- **处理方式**：将所有图片裁剪到统一尺寸（最大宽高）
  - 如果图片某个维度大于目标尺寸，会居中裁剪掉多余像素
  - 如果图片某个维度小于目标尺寸，会先用白底拓展，再裁剪到目标尺寸
- **效果**：确保所有批次图片尺寸完全一致，无边框

### 2. 无边框拓展模式
- **功能**：自动统计所有批次图片，找出最大宽度和最大高度，以此作为统一尺寸
- **处理方式**：将所有图片拓展到统一尺寸（最大宽高），完整保留原图
  - 原图会居中放置
  - 多余部分用白色背景填充
- **效果**：确保所有批次图片尺寸完全一致，无边框，且原图完整保留

## 实现细节

### 1. 参数更新
在 `🎨 缩放模式` 参数中添加了两个新选项：
- `无边框裁剪`
- `无边框拓展`

### 2. 核心逻辑

#### 统一尺寸计算
在处理批次图片之前，遍历所有批次图片，计算出最大宽度和最大高度：
```python
if resize_mode_en in ["borderless_crop", "borderless_expand"]:
    for img in batch_pils:
        if img.width > max_width:
            max_width = img.width
        if img.height > max_height:
            max_height = img.height
```

#### 网格尺寸调整
无边框模式下，网格尺寸使用实际的最大尺寸而不是固定的small_size：
```python
if resize_mode_en in ["borderless_crop", "borderless_expand"]:
    actual_width = max_width
    actual_height = max_height
else:
    actual_width = small_size
    actual_height = small_size

grid_width = grid_cols * actual_width + (grid_cols - 1) * spacing
grid_height = grid_rows * actual_height + (grid_rows - 1) * spacing
```

### 3. 新增方法

#### `resize_to_borderless_crop(image, target_width, target_height)`
- 将图片裁剪/拓展到目标尺寸
- 保证无边框（会裁掉多余像素或先拓展再裁剪）

#### `resize_to_borderless_expand(image, target_width, target_height)`
- 将图片拓展到目标尺寸
- 完整保留原图，用白底填充多余部分

### 4. 布局信息优化
在布局信息中显示批次图的实际尺寸：
- 普通模式：显示 `256×256`
- 无边框模式：显示 `1920×1080(统一尺寸)`

## 使用场景

### 适用场景
1. **混合横竖版图片**：当批次图片中既有横版又有竖版时，使用无边框模式可以保持统一尺寸
2. **保持原图完整性**：使用"无边框拓展"模式可以确保所有原图内容都得到保留
3. **优化排版效果**：无边框模式让排版更加整齐统一

### 模式选择建议
- **无边框裁剪**：适合不介意裁掉部分内容，追求紧凑排版的场景
- **无边框拓展**：适合需要完整保留所有图片内容的场景

## 注意事项

1. 无边框模式会自动忽略 `🔍 小图尺寸` 参数，使用批次图片中的最大尺寸
2. 拓展模式使用白色背景填充，如果需要其他颜色，可以修改代码中的 `(255, 255, 255)`
3. 如果批次图片尺寸差异很大，无边框模式可能会产生较大的画布

## 修改文件
- `e:\Comfyui_test\ComfyUI\custom_nodes\Dapao-Toolbox\image_layout_node.py`

## 测试建议
1. 准备一组横版和竖版混合的图片
2. 在ComfyUI中使用节点，选择"无边框裁剪"模式测试
3. 使用"无边框拓展"模式对比效果
4. 检查生成的布局信息是否正确显示统一尺寸
